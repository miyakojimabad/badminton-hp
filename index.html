<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="google-site-verification" content="hDJKNpob4sjI5wOyUoYMoMDHbV0oaLXUoUS2Ua_p1X8" />
  <title>å®®å¤ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å”ä¼š</title>
  <meta name="description" content="å®®å¤ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å”ä¼šã®å…¬å¼ã‚µã‚¤ãƒˆã€‚å¤§ä¼šæƒ…å ±ã€ç”³è¾¼ã€çµæœã€ãŠçŸ¥ã‚‰ã›ã‚’æ²è¼‰ã—ã¾ã™ã€‚" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="header">
    <div class="container">
      <nav class="nav">
        <a class="brand" href="index.html">
          <div class="brand-mark" aria-hidden="true"></div>
          <div class="brand-title">
            <strong>å®®å¤ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å”ä¼š</strong>
            <span>å…¬å¼ã‚µã‚¤ãƒˆ</span>
          </div>
        </a>

        <div class="menu">
          <a class="active" href="index.html">ãƒˆãƒƒãƒ—</a>
          <a href="notices.html">ãŠçŸ¥ã‚‰ã›</a>
          <a href="tournaments.html">å¤§ä¼šæƒ…å ±</a>
          <a href="results.html">çµæœ</a>
          <a href="about.html">å”ä¼šã«ã¤ã„ã¦</a>
          <a href="contact.html">å•ã„åˆã‚ã›</a>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <!-- ===== ãƒ’ãƒ¼ãƒ­ãƒ¼ ===== -->
    <section class="hero">
      <div class="container hero-grid">
        <div class="card hero-main">
          <span class="badge">ğŸ“£ æœ€æ–°æƒ…å ±ã¯ã€ŒãŠçŸ¥ã‚‰ã›ã€ã‚’ç¢ºèª</span>
          <h1>é›¢å³¶ã®ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³ã€ã‚‚ã£ã¨æ¥½ã—ãã€‚</h1>
          <p>
            å¤§ä¼šè¦é …ãƒ»ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ ãƒ»çµæœPDFãƒ»ç·´ç¿’ä¼šæƒ…å ±ãªã©ã‚’æ²è¼‰ã—ã¾ã™ã€‚<br>
          </p>

          <div class="actions">
            <a class="btn primary" href="tournaments.html">å¤§ä¼šæƒ…å ±ã‚’è¦‹ã‚‹</a>
            <a class="btn result" href="results.html">å¤§ä¼šçµæœã‚’è¦‹ã‚‹</a>
            <a class="btn" href="contact.html">å•ã„åˆã‚ã›</a>
          </div>

          <p class="small" style="margin-top:12px;">
          </p>
        </div>

        <aside class="card hero-side">
          <h2>ãŠçŸ¥ã‚‰ã›</h2>

          <!-- â˜…ãŠçŸ¥ã‚‰ã›ï¼šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰è‡ªå‹•åæ˜  -->
          <div class="list" id="noticesList">
            <div class="item">èª­ã¿è¾¼ã¿ä¸­...</div>
          </div>
        </aside>
      </div>
    </section>

    <!-- ===== å‹Ÿé›†ä¸­ã®å¤§ä¼šï¼ˆãƒˆãƒƒãƒ—ç”¨ï¼‰ ===== -->
    <section class="section">
      <div class="container">
        <h2>å‹Ÿé›†ä¸­ã®å¤§ä¼š</h2>

        <!-- â˜…å¤§ä¼šæƒ…å ±ï¼šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰è‡ªå‹•åæ˜ ï¼ˆå‹Ÿé›†ä¸­ã®ã¿ï¼‰ -->
        <div class="grid" id="topTournaments">
          <div class="card box">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>

        <p class="small" style="margin-top:10px;">
          <a href="tournaments.html">å¤§ä¼šæƒ…å ±ä¸€è¦§ã‚’è¦‹ã‚‹ â†’</a>
        </p>
      </div>
    </section>

    <!-- ===== ã‚ˆãä½¿ã†ãƒªãƒ³ã‚¯ ===== -->
    <section class="section">
      <div class="container">
        <h2>ã‚ˆãä½¿ã†ãƒªãƒ³ã‚¯</h2>

        <!-- â˜…ãƒªãƒ³ã‚¯ï¼šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰è‡ªå‹•åæ˜  -->
        <div class="grid" id="linksGrid">
          <div class="card box">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="row">
        <div>Â© <span id="y"></span> å®®å¤ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³å”ä¼š</div>
        <div>æ›´æ–°æ‹…å½“ï¼šç«¹ä¸­æ‚ ï¼ˆé€£çµ¡å…ˆã¯å•ã„åˆã‚ã›ãƒšãƒ¼ã‚¸ã¸ï¼‰</div>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById("y").textContent = new Date().getFullYear();
  </script>

  <!-- ===== ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æºï¼ˆJSONPç‰ˆï¼‰ ===== -->
  <script>
    // â˜…ã‚ãªãŸã®Apps Script Webã‚¢ãƒ—ãƒªURLï¼ˆ/execã¾ã§ï¼‰ã«ç½®ãæ›ãˆ
    const API_BASE = "https://script.googleusercontent.com/macros/s/AKfycbzSk_APUGIBsY1GXxy7OHhlMmsbgguy2xrOTi3qrExbFsap8wOM6s_b-vQnyvPvGXW0/exec";

    function esc(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }

    // â˜…2026-01-10T15:00:00.000Z â†’ 2026-01-10
    function formatDate(d){
      if(!d) return "";
      const dt = new Date(d);
      if (isNaN(dt)) return String(d);     // ã‚‚ã—æ—¢ã«æ–‡å­—åˆ—ãªã‚‰ãã®ã¾ã¾
      return dt.toISOString().slice(0,10); // YYYY-MM-DD
    }

    function tagClass(tag){
      if(tag === "å‹Ÿé›†ä¸­") return "open";
      if(tag === "çµ‚äº†") return "closed";
      return "";
    }

    // â˜…JSONPï¼ˆCORSå›é¿ï¼‰
    function jsonp(type){
      return new Promise((resolve, reject) => {
        const cb = "cb_" + Math.random().toString(16).slice(2);
        window[cb] = (data) => {
          delete window[cb];
          script.remove();
          resolve(data);
        };
        const script = document.createElement("script");
        script.src = `${API_BASE}?type=${encodeURIComponent(type)}&callback=${cb}`;
        script.onerror = () => reject(new Error("JSONP load failed"));
        document.body.appendChild(script);
      });
    }

    async function fetchItems(type){
      const data = await jsonp(type);
      if(!data.ok) throw new Error(data.error || "API error");
      return data.items || [];
    }

    // ===== ãŠçŸ¥ã‚‰ã› =====
    async function loadNotices(){
      const el = document.getElementById("noticesList");
      if(!el) return;

      try{
        const items = await fetchItems("notices");
        if(items.length === 0){
          el.innerHTML = `<div class="item">ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
          return;
        }

        el.innerHTML = items.slice(0,5).map(n => `
          <div class="item">
            <div class="meta">
              <span class="tag ${tagClass(String(n.tag||""))}">${esc(n.tag || "æ›´æ–°")}</span>
              <span>${esc(formatDate(n.date))}</span>
            </div>
            <strong>${esc(n.title || "")}</strong>
            ${n.url ? `<a href="${esc(n.url)}">è©³ç´°ã‚’è¦‹ã‚‹ â†’</a>` : ""}
          </div>
        `).join("");
      }catch(e){
        console.error(e);
        el.innerHTML = `<div class="item">ãŠçŸ¥ã‚‰ã›ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>`;
      }
    }

    // ===== å‹Ÿé›†ä¸­ã®å¤§ä¼šï¼ˆãƒˆãƒƒãƒ—ç”¨ï¼š3ä»¶ã¾ã§ï¼‰ =====
    async function loadTopTournaments(){
      const el = document.getElementById("topTournaments");
      if(!el) return;

      try{
        const items = await fetchItems("tournaments");

        // status ãŒã€Œå‹Ÿé›†ä¸­ã€ã®ã‚‚ã®ã ã‘è¡¨ç¤ºï¼ˆ3ä»¶ã¾ã§ï¼‰
        const open = items.filter(t => String(t.status || "") === "å‹Ÿé›†ä¸­").slice(0,3);

        if(open.length === 0){
          el.innerHTML = `<div class="card box">ç¾åœ¨ã€å‹Ÿé›†ä¸­ã®å¤§ä¼šã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
          return;
        }

        el.innerHTML = open.map(t => `
          <div class="card box">
            <h3>${esc(t.name || "")}</h3>
            <p class="small">
              é–‹å‚¬æ—¥ï¼š${esc(formatDate(t.date))}<br>
              ä¼šå ´ï¼š${esc(t.venue || "æœªå®š")}
            </p>
            <p style="margin-top:10px;">
              <a href="tournaments.html">è©³ç´°ãƒ»ç”³è¾¼ã‚’è¦‹ã‚‹ â†’</a>
            </p>
          </div>
        `).join("");
      }catch(e){
        console.error(e);
        el.innerHTML = `<div class="card box">å¤§ä¼šæƒ…å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>`;
      }
    }

    // ===== ã‚ˆãä½¿ã†ãƒªãƒ³ã‚¯ =====
    async function loadLinks(){
      const el = document.getElementById("linksGrid");
      if(!el) return;

      try{
        const items = await fetchItems("links");
        if(items.length === 0){
          el.innerHTML = `<div class="card box">ãƒªãƒ³ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
          return;
        }

        el.innerHTML = items.map(l => `
          <div class="card box">
            <h3>${esc(l.title || "")}</h3>
            <p>${esc(l.description || "")}</p>
            ${l.url ? `<p style="margin-top:10px;"><a href="${esc(l.url)}">é–‹ã â†’</a></p>` : ""}
          </div>
        `).join("");
      }catch(e){
        console.error(e);
        el.innerHTML = `<div class="card box">ãƒªãƒ³ã‚¯ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>`;
      }
    }

    loadNotices();
    loadTopTournaments();
    loadLinks();
  </script>
</body>
</html>
